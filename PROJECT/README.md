# JetSon_Project_Yolo

![alt text](https://github.com/YuioiuY/GetStartedCV/tree/PROJECT/video/dep.gif)


## App 

Приложение написано на базе библиотеки customtkinter. В приложении есть всего лишь две кнопки для максимального упрощения процесса настройки.
Кнопка **Подключиться**: 
1. Подключение через wifi-роутер к Jetson. 
2. Получаем данные с Jetson. 
3. Разворачиваем на базе приложения мини сервер на приём изображения. 
Задержка трансляции видео по сети состовляет 1~2 секунды, так же при подключении падает fps в пределах 0.4 fps. 

id сообщения лучше не трогать, пока не будет тестов на реальном объекте (Посылка CAN). 

Настройки максимально просты и не требуют глубоких познаний. 

![alt text](https://github.com/YuioiuY/GetStartedCV/tree/PROJECT/img/2023-10-09_11-47-21.png)


## Функционал 

Запуск 4-ех потоков: 

- Камера + (отправка кадра)
- CAN шина 
- Чтение сокета 
- Отправка сокета 

Сохранение параметров после удаленного изменения (не внутренних).
Для удаленной настроки подготовлен тестовый клиент для отправки следующих сообщений: 

- pack {'video': 0, 'ip':'102.202.100.2,'port':3422} - запуск трансляции видео

- pack {'h_d':123, 'w_d':321,'h_tl':123, 'w_tl':321,'h_tr':123, 'w_tr':321, 'obj':[person,track,car,dog], 'accuracy': 0.43, "can": true, "id": 512 } - запись данных от клиента

- ty - прекращение отправки данных 

- give - старт отправки параметров {'h_d':123, 'w_d':321,'h_tl':123, 'w_tl':321,'h_tr':123, 'w_tr':321, 'obj':[person,track,car,dog], 'accuracy': 0.43, "can": true, "id": 512 }

- kill - остановка видео потока

Отправка параметров настройки 

- pack {'h_d':123, 'w_d':321,'h_tl':123, 'w_tl':321,'h_tr':123, 'w_tr':321, 'obj':[person,track,car,dog], 'accuracy': 0.43, "can": true, "id": 512 } - отправка данных клиенту

Трансляция видео реализованна пока что в основном потоке камеры, проверка реализована по кабелю Ethrnet и WIFI.
Основной шлюз роутера 0.0.0.0

ВНИМАНИЕ! есть две версии:

- для трансляции с 1-ой камеры 
![alt text](https://github.com/YuioiuY/GetStartedCV/tree/PROJECT/img/1camapp.png)

- для трансляции с 4-ех камер 
![alt text](https://github.com/YuioiuY/GetStartedCV/tree/PROJECT/img/4camapp.png)


- Так же еть две версии для jetson! 

Так же ускорена передача видео потока по локальной сети, уменьшена задержка на 3-4 секунды.

Три версии приложения для 1-ой аналоговой камеры, 4-ех аналоговы камер и для usb камеры.

## РОУТЕР

Роутер должен быть настроен следующим образом
1) минимальное количество доступны подключений 2-5
2) ip основного шлюза 0.0.0.0

Сейчас доступ к роутеру через сайт можно получить по 0.0.0.0 и ввести пароль 1-8.
Для пользователя:

- Сеть: Vision
- Пароль: #########


## SH-files

- auto.sh это старая версия запуска программы
- auto-four.sh это новая версия для запуска программы для 4 камер
- auto-one.sh  это новая версия для запуска программы для 1 камеры
- sen.h для контроля температур (упращенная версия)

## Scaner Temperature

При запуске сканера, создаётся файл, куда пишутся логи температур, запускать только для проверки, на постоянку не использовать.


## USB CAN

- Реализована связь через флешку USBCAN 
- Добавлена обработка сообщений с левоого джойстика для версии с 4-мя камерами, теперь если машина стоит, тогда определение не работает, при начале движения вперед определение работает только на 3 кмеры (правая, левая, передняя), при движении назад (задняя ... логично? логично.)
- Плата Arduino больше не актуальна и не используется.

## Py

- Полность переделенный пример из инструкции, пока что есть определение людей, машины, грузовиков/спецтехники и собак.

При работе с камерами ОБРАЩАЙТЕ внимание на доступный формат. Идеальный формат это YUY2.

- Настройку для камеры не трогать: 
1. gstr = 'v4l2src device=/dev/video0 ! video/x-raw,format=YUY2,width=640,height=480,framerate=30/1 ! videoconvert ! video/x-raw,format=BGR ! appsink' 
2. self.cap  = cv2.VideoCapture(gstr, cv2.CAP_GSTREAMER)
3. от 12 fps до 18 fps
  
При работе с картой видеозахвата было выявлено, что могут возникать ошибки при захвате изображения через => cv2.VideoCapture(0) !!!

## Установка Jetson Linux 

- https://developer.nvidia.com/embedded/learn/get-started-jetson-nano-devkit#intro

Качать только отсюда, удобные для вас версии ubuntu, kali и т.д. не поддерживаются.

## Установка Yolo

- Для установка Yolo и работы с ним, требуется ``python 3.6.9``
- Инструкция --> https://www.hackster.io/spehj/deploy-yolov7-to-jetson-nano-for-object-detection-6728c3
- PyCuda --> https://github.com/jetson-nano-wheels/python3.6-pycuda-2021.1
- c PyCuda могут возникнуть проблемы, установка производится в виртуальной среде, которую вы установите по ходу инструкции для yolo

## Password
-#####

## Комплектация  

https://www.dns-shop.ru/product/c75bd23e40b2526f/wi-fi-router-tp-link-tl-mr3020/
https://www.dns-shop.ru/product/29af430b8abe2ff0/ustrojstvo-videozahvata-orient-c703hvc/
https://supereyes.ru/catalog/mikrokompyutery_nvidia_jetson/jetson_nano_4gb_developer_kit_sub/ 

+ понижайка + флешка USB-CAN + провода + радиаторы и термопрокладки 


![alt text](https://github.com/YuioiuY/GetStartedCV/tree/PROJECT/video/jet.png)


## Build 

1) Проверить установлен ли pyinstaller 
2) Добавить pyinstaller.exe в переменную PATH
3) Перейти в папку с файлом который надо сбилдить (в моёмм случае -> cd app_tk_ver2)
4) Из файла install.txt  скопировать команду 
5) запустить консль 

pyinstaller -w --name=DST4Vision --icon=img\vision_new.ico Ctk_app.py

После билда будет 2 папки и один файл 
- build & name.spec (не трогаем)
- dist (проваливаемся до exe фалйла и закидываем туда папку с картинками **img**)


